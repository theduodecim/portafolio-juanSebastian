"use strict";(globalThis.webpackChunkdocusaurus_juan_sebastian=globalThis.webpackChunkdocusaurus_juan_sebastian||[]).push([[4821],{1645:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"snippets/docker-devops-snippets","title":"Docker & DevOps \u2014 Patrones Modernos & Snippets Reutilizables","description":"Esta secci\xf3n re\xfane configuraciones pr\xe1cticas de Docker, Docker Compose, CI/CD con GitHub Actions, Nginx reverse proxy y estrategias de deployment en producci\xf3n.","source":"@site/docs/snippets/docker-devops-snippets.md","sourceDirName":"snippets","slug":"/snippets/docker-devops-snippets","permalink":"/portafolio-juanSebastian/docs/snippets/docker-devops-snippets","draft":false,"unlisted":false,"editUrl":"https://github.com/TheDuodecim/juan-sebastian-docs/tree/main/docs/snippets/docker-devops-snippets.md","tags":[],"version":"current","frontMatter":{"id":"docker-devops-snippets","title":"Docker & DevOps \u2014 Patrones Modernos & Snippets Reutilizables"},"sidebar":"techSidebar","previous":{"title":"Backend \u2014 Patrones Modernos & Snippets Reutilizables","permalink":"/portafolio-juanSebastian/docs/snippets/backend-snippets"}}');var o=s(4848),r=s(8453);const i={id:"docker-devops-snippets",title:"Docker & DevOps \u2014 Patrones Modernos & Snippets Reutilizables"},a="Docker & DevOps \u2014 Patrones Modernos & Snippets Reutilizables",c={},d=[{value:"\ud83d\udc33 Dockerfiles Optimizados",id:"-dockerfiles-optimizados",level:2},{value:"Node.js + TypeScript (Multi-stage Build)",id:"nodejs--typescript-multi-stage-build",level:3},{value:"Angular/React (Production Build)",id:"angularreact-production-build",level:3},{value:"Next.js Standalone",id:"nextjs-standalone",level:3},{value:"API REST + Database Connection",id:"api-rest--database-connection",level:3},{value:"\ud83d\udc19 Docker Compose Completo",id:"-docker-compose-completo",level:2},{value:"Stack Full (Frontend + Backend + DB + Nginx)",id:"stack-full-frontend--backend--db--nginx",level:3},{value:"Development con Hot Reload",id:"development-con-hot-reload",level:3},{value:"\ud83d\udd27 Nginx Configurations",id:"-nginx-configurations",level:2},{value:"Reverse Proxy con SSL",id:"reverse-proxy-con-ssl",level:3},{value:"Load Balancer con Health Checks",id:"load-balancer-con-health-checks",level:3},{value:"\ud83d\ude80 GitHub Actions CI/CD",id:"-github-actions-cicd",level:2},{value:"Build, Test &amp; Deploy to Production",id:"build-test--deploy-to-production",level:3},{value:"Multi-Environment Deploy",id:"multi-environment-deploy",level:3},{value:"\ud83d\udce6 Docker Utilities",id:"-docker-utilities",level:2},{value:"Docker Compose Commands \xdatiles",id:"docker-compose-commands-\xfatiles",level:3},{value:"Healthcheck Script (Node.js)",id:"healthcheck-script-nodejs",level:3},{value:"Entrypoint Script",id:"entrypoint-script",level:3},{value:"\ud83d\udd10 Secrets Management",id:"-secrets-management",level:2},{value:".env.example",id:"envexample",level:3},{value:"\ud83c\udfaf Best Practices",id:"-best-practices",level:2},{value:"\ud83d\udcda Recursos",id:"-recursos",level:2}];function l(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"docker--devops--patrones-modernos--snippets-reutilizables",children:"Docker & DevOps \u2014 Patrones Modernos & Snippets Reutilizables"})}),"\n",(0,o.jsx)(e.p,{children:"Esta secci\xf3n re\xfane configuraciones pr\xe1cticas de Docker, Docker Compose, CI/CD con GitHub Actions, Nginx reverse proxy y estrategias de deployment en producci\xf3n."}),"\n",(0,o.jsx)(e.hr,{}),"\n",(0,o.jsx)(e.h2,{id:"-dockerfiles-optimizados",children:"\ud83d\udc33 Dockerfiles Optimizados"}),"\n",(0,o.jsx)(e.h3,{id:"nodejs--typescript-multi-stage-build",children:"Node.js + TypeScript (Multi-stage Build)"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-dockerfile",children:'# Build stage\nFROM node:20-alpine AS builder\n\nWORKDIR /app\n\n# Copy package files\nCOPY package*.json ./\nCOPY tsconfig.json ./\n\n# Install dependencies\nRUN npm ci --only=production && \\\n    npm cache clean --force\n\n# Copy source code\nCOPY src ./src\n\n# Build TypeScript\nRUN npm run build\n\n# Production stage\nFROM node:20-alpine\n\nWORKDIR /app\n\n# Copy only necessary files\nCOPY --from=builder /app/node_modules ./node_modules\nCOPY --from=builder /app/dist ./dist\nCOPY --from=builder /app/package*.json ./\n\n# Create non-root user\nRUN addgroup -g 1001 -S nodejs && \\\n    adduser -S nodejs -u 1001\n\nUSER nodejs\n\nEXPOSE 3000\n\nCMD ["node", "dist/index.js"]\n'})}),"\n",(0,o.jsx)(e.h3,{id:"angularreact-production-build",children:"Angular/React (Production Build)"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-dockerfile",children:'# Build stage\nFROM node:20-alpine AS builder\n\nWORKDIR /app\n\nCOPY package*.json ./\nRUN npm ci\n\nCOPY . .\nRUN npm run build\n\n# Production stage with Nginx\nFROM nginx:alpine\n\n# Copy custom nginx config\nCOPY nginx.conf /etc/nginx/nginx.conf\n\n# Copy built app\nCOPY --from=builder /app/dist /usr/share/nginx/html\n\n# Add healthcheck\nHEALTHCHECK --interval=30s --timeout=3s \\\n  CMD wget --quiet --tries=1 --spider http://localhost:80/health || exit 1\n\nEXPOSE 80\n\nCMD ["nginx", "-g", "daemon off;"]\n'})}),"\n",(0,o.jsx)(e.h3,{id:"nextjs-standalone",children:"Next.js Standalone"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-dockerfile",children:'FROM node:20-alpine AS base\n\n# Dependencies stage\nFROM base AS deps\nWORKDIR /app\n\nCOPY package*.json ./\nRUN npm ci\n\n# Builder stage\nFROM base AS builder\nWORKDIR /app\n\nCOPY --from=deps /app/node_modules ./node_modules\nCOPY . .\n\nRUN npm run build\n\n# Production stage\nFROM base AS runner\nWORKDIR /app\n\nENV NODE_ENV=production\n\nRUN addgroup --system --gid 1001 nodejs && \\\n    adduser --system --uid 1001 nextjs\n\nCOPY --from=builder /app/public ./public\nCOPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./\nCOPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static\n\nUSER nextjs\n\nEXPOSE 3000\n\nCMD ["node", "server.js"]\n'})}),"\n",(0,o.jsx)(e.h3,{id:"api-rest--database-connection",children:"API REST + Database Connection"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-dockerfile",children:'FROM node:20-alpine\n\nWORKDIR /app\n\n# Install dependencies first (better caching)\nCOPY package*.json ./\nRUN npm ci --only=production\n\n# Copy application code\nCOPY . .\n\n# Environment variables\nENV NODE_ENV=production\nENV PORT=3000\n\n# Health check\nHEALTHCHECK --interval=30s --timeout=5s --start-period=30s \\\n  CMD node healthcheck.js\n\nEXPOSE 3000\n\nCMD ["node", "server.js"]\n'})}),"\n",(0,o.jsx)(e.hr,{}),"\n",(0,o.jsx)(e.h2,{id:"-docker-compose-completo",children:"\ud83d\udc19 Docker Compose Completo"}),"\n",(0,o.jsx)(e.h3,{id:"stack-full-frontend--backend--db--nginx",children:"Stack Full (Frontend + Backend + DB + Nginx)"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-yaml",children:'version: \'3.8\'\n\nservices:\n  # PostgreSQL Database\n  postgres:\n    image: postgres:16-alpine\n    container_name: app_postgres\n    restart: unless-stopped\n    environment:\n      POSTGRES_DB: myapp\n      POSTGRES_USER: ${DB_USER}\n      POSTGRES_PASSWORD: ${DB_PASSWORD}\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n      - ./init.sql:/docker-entrypoint-initdb.d/init.sql\n    networks:\n      - app_network\n    healthcheck:\n      test: ["CMD-SHELL", "pg_isready -U ${DB_USER}"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n\n  # Redis Cache\n  redis:\n    image: redis:7-alpine\n    container_name: app_redis\n    restart: unless-stopped\n    command: redis-server --appendonly yes\n    volumes:\n      - redis_data:/data\n    networks:\n      - app_network\n    healthcheck:\n      test: ["CMD", "redis-cli", "ping"]\n      interval: 10s\n      timeout: 3s\n      retries: 5\n\n  # Backend API\n  backend:\n    build:\n      context: ./backend\n      dockerfile: Dockerfile\n    container_name: app_backend\n    restart: unless-stopped\n    environment:\n      NODE_ENV: production\n      DATABASE_URL: postgresql://${DB_USER}:${DB_PASSWORD}@postgres:5432/myapp\n      REDIS_URL: redis://redis:6379\n      JWT_SECRET: ${JWT_SECRET}\n      PORT: 3000\n    depends_on:\n      postgres:\n        condition: service_healthy\n      redis:\n        condition: service_healthy\n    networks:\n      - app_network\n    volumes:\n      - ./backend/uploads:/app/uploads\n    expose:\n      - "3000"\n\n  # Frontend\n  frontend:\n    build:\n      context: ./frontend\n      dockerfile: Dockerfile\n      args:\n        NEXT_PUBLIC_API_URL: ${API_URL}\n    container_name: app_frontend\n    restart: unless-stopped\n    depends_on:\n      - backend\n    networks:\n      - app_network\n    expose:\n      - "3000"\n\n  # Nginx Reverse Proxy\n  nginx:\n    image: nginx:alpine\n    container_name: app_nginx\n    restart: unless-stopped\n    ports:\n      - "80:80"\n      - "443:443"\n    volumes:\n      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro\n      - ./nginx/ssl:/etc/nginx/ssl:ro\n      - ./nginx/logs:/var/log/nginx\n    depends_on:\n      - backend\n      - frontend\n    networks:\n      - app_network\n\nvolumes:\n  postgres_data:\n    driver: local\n  redis_data:\n    driver: local\n\nnetworks:\n  app_network:\n    driver: bridge\n'})}),"\n",(0,o.jsx)(e.h3,{id:"development-con-hot-reload",children:"Development con Hot Reload"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-yaml",children:'version: \'3.8\'\n\nservices:\n  backend:\n    build:\n      context: ./backend\n      dockerfile: Dockerfile.dev\n    container_name: dev_backend\n    volumes:\n      - ./backend:/app\n      - /app/node_modules\n    environment:\n      NODE_ENV: development\n      DATABASE_URL: postgresql://dev:dev123@postgres:5432/devdb\n    ports:\n      - "3001:3000"\n    command: npm run dev\n    networks:\n      - dev_network\n\n  frontend:\n    build:\n      context: ./frontend\n      dockerfile: Dockerfile.dev\n    container_name: dev_frontend\n    volumes:\n      - ./frontend:/app\n      - /app/node_modules\n      - /app/.next\n    environment:\n      NEXT_PUBLIC_API_URL: http://localhost:3001\n    ports:\n      - "3000:3000"\n    command: npm run dev\n    networks:\n      - dev_network\n\n  postgres:\n    image: postgres:16-alpine\n    container_name: dev_postgres\n    environment:\n      POSTGRES_DB: devdb\n      POSTGRES_USER: dev\n      POSTGRES_PASSWORD: dev123\n    ports:\n      - "5432:5432"\n    volumes:\n      - dev_postgres_data:/var/lib/postgresql/data\n    networks:\n      - dev_network\n\nvolumes:\n  dev_postgres_data:\n\nnetworks:\n  dev_network:\n    driver: bridge\n'})}),"\n",(0,o.jsx)(e.hr,{}),"\n",(0,o.jsx)(e.h2,{id:"-nginx-configurations",children:"\ud83d\udd27 Nginx Configurations"}),"\n",(0,o.jsx)(e.h3,{id:"reverse-proxy-con-ssl",children:"Reverse Proxy con SSL"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-nginx",children:'# /etc/nginx/nginx.conf\n\nevents {\n    worker_connections 1024;\n}\n\nhttp {\n    include /etc/nginx/mime.types;\n    default_type application/octet-stream;\n\n    # Logging\n    access_log /var/log/nginx/access.log;\n    error_log /var/log/nginx/error.log;\n\n    # Performance\n    sendfile on;\n    tcp_nopush on;\n    tcp_nodelay on;\n    keepalive_timeout 65;\n    types_hash_max_size 2048;\n\n    # Gzip compression\n    gzip on;\n    gzip_vary on;\n    gzip_min_length 1024;\n    gzip_types text/plain text/css application/json application/javascript text/xml application/xml;\n\n    # Rate limiting\n    limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;\n    limit_req_zone $binary_remote_addr zone=general_limit:10m rate=30r/s;\n\n    # Upstream backends\n    upstream backend_api {\n        least_conn;\n        server backend:3000 max_fails=3 fail_timeout=30s;\n    }\n\n    upstream frontend_app {\n        least_conn;\n        server frontend:3000 max_fails=3 fail_timeout=30s;\n    }\n\n    # Redirect HTTP to HTTPS\n    server {\n        listen 80;\n        server_name example.com www.example.com;\n        return 301 https://$server_name$request_uri;\n    }\n\n    # HTTPS Server\n    server {\n        listen 443 ssl http2;\n        server_name example.com www.example.com;\n\n        # SSL Configuration\n        ssl_certificate /etc/nginx/ssl/fullchain.pem;\n        ssl_certificate_key /etc/nginx/ssl/privkey.pem;\n        ssl_protocols TLSv1.2 TLSv1.3;\n        ssl_ciphers HIGH:!aNULL:!MD5;\n        ssl_prefer_server_ciphers on;\n\n        # Security Headers\n        add_header X-Frame-Options "SAMEORIGIN" always;\n        add_header X-Content-Type-Options "nosniff" always;\n        add_header X-XSS-Protection "1; mode=block" always;\n        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;\n\n        # API Routes\n        location /api {\n            limit_req zone=api_limit burst=20 nodelay;\n            \n            proxy_pass http://backend_api;\n            proxy_http_version 1.1;\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection \'upgrade\';\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n            proxy_cache_bypass $http_upgrade;\n            \n            # Timeouts\n            proxy_connect_timeout 60s;\n            proxy_send_timeout 60s;\n            proxy_read_timeout 60s;\n        }\n\n        # WebSocket Support\n        location /ws {\n            proxy_pass http://backend_api;\n            proxy_http_version 1.1;\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection "upgrade";\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n        }\n\n        # Static files with caching\n        location ~* \\.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf)$ {\n            proxy_pass http://frontend_app;\n            expires 1y;\n            add_header Cache-Control "public, immutable";\n        }\n\n        # Frontend App\n        location / {\n            limit_req zone=general_limit burst=50 nodelay;\n            \n            proxy_pass http://frontend_app;\n            proxy_http_version 1.1;\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection \'upgrade\';\n            proxy_set_header Host $host;\n            proxy_cache_bypass $http_upgrade;\n        }\n\n        # Health check endpoint\n        location /health {\n            access_log off;\n            return 200 "healthy\\n";\n            add_header Content-Type text/plain;\n        }\n    }\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"load-balancer-con-health-checks",children:"Load Balancer con Health Checks"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-nginx",children:'upstream backend_cluster {\n    least_conn;\n    \n    server backend1:3000 max_fails=3 fail_timeout=30s;\n    server backend2:3000 max_fails=3 fail_timeout=30s;\n    server backend3:3000 max_fails=3 fail_timeout=30s;\n    \n    keepalive 32;\n}\n\nserver {\n    listen 80;\n    \n    location / {\n        proxy_pass http://backend_cluster;\n        proxy_http_version 1.1;\n        proxy_set_header Connection "";\n        \n        # Health check\n        proxy_next_upstream error timeout http_500 http_502 http_503;\n    }\n}\n'})}),"\n",(0,o.jsx)(e.hr,{}),"\n",(0,o.jsx)(e.h2,{id:"-github-actions-cicd",children:"\ud83d\ude80 GitHub Actions CI/CD"}),"\n",(0,o.jsx)(e.h3,{id:"build-test--deploy-to-production",children:"Build, Test & Deploy to Production"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-yaml",children:"# .github/workflows/deploy.yml\n\nname: CI/CD Pipeline\n\non:\n  push:\n    branches: [main, develop]\n  pull_request:\n    branches: [main]\n\nenv:\n  REGISTRY: ghcr.io\n  IMAGE_NAME: ${{ github.repository }}\n\njobs:\n  # Test Job\n  test:\n    runs-on: ubuntu-latest\n    \n    steps:\n      - name: Checkout code\n        uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Run linter\n        run: npm run lint\n\n      - name: Run tests\n        run: npm test -- --coverage\n\n      - name: Upload coverage\n        uses: codecov/codecov-action@v3\n        with:\n          files: ./coverage/lcov.info\n\n  # Build and Push Docker Image\n  build:\n    needs: test\n    runs-on: ubuntu-latest\n    if: github.event_name == 'push'\n    \n    permissions:\n      contents: read\n      packages: write\n\n    steps:\n      - name: Checkout code\n        uses: actions/checkout@v4\n\n      - name: Set up Docker Buildx\n        uses: docker/setup-buildx-action@v3\n\n      - name: Log in to Container Registry\n        uses: docker/login-action@v3\n        with:\n          registry: ${{ env.REGISTRY }}\n          username: ${{ github.actor }}\n          password: ${{ secrets.GITHUB_TOKEN }}\n\n      - name: Extract metadata\n        id: meta\n        uses: docker/metadata-action@v5\n        with:\n          images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}\n          tags: |\n            type=ref,event=branch\n            type=semver,pattern={{version}}\n            type=sha,prefix={{branch}}-\n\n      - name: Build and push Docker image\n        uses: docker/build-push-action@v5\n        with:\n          context: .\n          push: true\n          tags: ${{ steps.meta.outputs.tags }}\n          labels: ${{ steps.meta.outputs.labels }}\n          cache-from: type=gha\n          cache-to: type=gha,mode=max\n\n  # Deploy to Production\n  deploy:\n    needs: build\n    runs-on: ubuntu-latest\n    if: github.ref == 'refs/heads/main'\n    \n    steps:\n      - name: Checkout code\n        uses: actions/checkout@v4\n\n      - name: Deploy to server\n        uses: appleboy/ssh-action@master\n        with:\n          host: ${{ secrets.SERVER_HOST }}\n          username: ${{ secrets.SERVER_USER }}\n          key: ${{ secrets.SSH_PRIVATE_KEY }}\n          script: |\n            cd /var/www/myapp\n            docker-compose pull\n            docker-compose up -d --remove-orphans\n            docker image prune -f\n\n      - name: Health check\n        run: |\n          sleep 30\n          curl -f https://myapp.com/health || exit 1\n\n      - name: Notify deployment\n        if: success()\n        uses: 8398a7/action-slack@v3\n        with:\n          status: custom\n          custom_payload: |\n            {\n              text: \"\u2705 Deployment successful to production\",\n              fields: [\n                {\n                  title: \"Commit\",\n                  value: \"${{ github.sha }}\",\n                  short: true\n                }\n              ]\n            }\n        env:\n          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}\n"})}),"\n",(0,o.jsx)(e.h3,{id:"multi-environment-deploy",children:"Multi-Environment Deploy"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-yaml",children:'name: Multi-Environment Deploy\n\non:\n  push:\n    branches: [main, staging, develop]\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    \n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n\n      - name: Determine environment\n        id: env\n        run: |\n          if [[ "${{ github.ref }}" == "refs/heads/main" ]]; then\n            echo "environment=production" >> $GITHUB_OUTPUT\n            echo "url=https://app.example.com" >> $GITHUB_OUTPUT\n          elif [[ "${{ github.ref }}" == "refs/heads/staging" ]]; then\n            echo "environment=staging" >> $GITHUB_OUTPUT\n            echo "url=https://staging.example.com" >> $GITHUB_OUTPUT\n          else\n            echo "environment=development" >> $GITHUB_OUTPUT\n            echo "url=https://dev.example.com" >> $GITHUB_OUTPUT\n          fi\n\n      - name: Deploy to ${{ steps.env.outputs.environment }}\n        uses: appleboy/ssh-action@master\n        with:\n          host: ${{ secrets[format(\'SERVER_HOST_{0}\', steps.env.outputs.environment)] }}\n          username: ${{ secrets.SERVER_USER }}\n          key: ${{ secrets.SSH_PRIVATE_KEY }}\n          script: |\n            cd /var/www/${{ steps.env.outputs.environment }}\n            git pull origin ${{ github.ref_name }}\n            docker-compose -f docker-compose.${{ steps.env.outputs.environment }}.yml up -d\n            \n      - name: Verify deployment\n        run: |\n          sleep 20\n          curl -f ${{ steps.env.outputs.url }}/health || exit 1\n'})}),"\n",(0,o.jsx)(e.hr,{}),"\n",(0,o.jsx)(e.h2,{id:"-docker-utilities",children:"\ud83d\udce6 Docker Utilities"}),"\n",(0,o.jsx)(e.h3,{id:"docker-compose-commands-\xfatiles",children:"Docker Compose Commands \xdatiles"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"# Build sin cache\ndocker-compose build --no-cache\n\n# Ver logs de un servicio espec\xedfico\ndocker-compose logs -f backend\n\n# Ejecutar comando en contenedor\ndocker-compose exec backend npm run migrate\n\n# Escalar servicio\ndocker-compose up -d --scale backend=3\n\n# Ver recursos usados\ndocker stats\n\n# Limpiar todo (cuidado en producci\xf3n)\ndocker system prune -a --volumes\n"})}),"\n",(0,o.jsx)(e.h3,{id:"healthcheck-script-nodejs",children:"Healthcheck Script (Node.js)"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-javascript",children:"// healthcheck.js\nconst http = require('http');\n\nconst options = {\n  host: 'localhost',\n  port: process.env.PORT || 3000,\n  path: '/health',\n  timeout: 2000\n};\n\nconst request = http.request(options, (res) => {\n  console.log(`STATUS: ${res.statusCode}`);\n  if (res.statusCode === 200) {\n    process.exit(0);\n  } else {\n    process.exit(1);\n  }\n});\n\nrequest.on('error', (err) => {\n  console.log('ERROR:', err);\n  process.exit(1);\n});\n\nrequest.end();\n"})}),"\n",(0,o.jsx)(e.h3,{id:"entrypoint-script",children:"Entrypoint Script"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:'#!/bin/sh\n# entrypoint.sh\n\nset -e\n\necho "\ud83d\ude80 Starting application..."\n\n# Wait for database\necho "\u23f3 Waiting for database..."\nwhile ! nc -z postgres 5432; do\n  sleep 1\ndone\necho "\u2705 Database is ready"\n\n# Run migrations\necho "\ud83d\udd04 Running migrations..."\nnpm run migrate\n\n# Start application\necho "\u2705 Starting server..."\nexec "$@"\n'})}),"\n",(0,o.jsx)(e.hr,{}),"\n",(0,o.jsx)(e.h2,{id:"-secrets-management",children:"\ud83d\udd10 Secrets Management"}),"\n",(0,o.jsx)(e.h3,{id:"envexample",children:".env.example"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"# Database\nDB_USER=myuser\nDB_PASSWORD=securepassword\nDB_NAME=myapp\nDATABASE_URL=postgresql://${DB_USER}:${DB_PASSWORD}@postgres:5432/${DB_NAME}\n\n# Redis\nREDIS_URL=redis://redis:6379\n\n# JWT\nJWT_SECRET=your-super-secret-jwt-key\nJWT_EXPIRES_IN=7d\n\n# API Keys\nAPI_KEY=your-api-key\nSTRIPE_SECRET_KEY=sk_test_xxx\n\n# Frontend\nNEXT_PUBLIC_API_URL=https://api.example.com\nNEXT_PUBLIC_WS_URL=wss://api.example.com\n\n# Email\nSMTP_HOST=smtp.gmail.com\nSMTP_PORT=587\nSMTP_USER=your-email@gmail.com\nSMTP_PASS=your-app-password\n\n# Monitoring\nSENTRY_DSN=https://xxx@sentry.io/xxx\n"})}),"\n",(0,o.jsx)(e.hr,{}),"\n",(0,o.jsx)(e.h2,{id:"-best-practices",children:"\ud83c\udfaf Best Practices"}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Multi-stage builds"})," para im\xe1genes peque\xf1as"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Non-root users"})," en contenedores para seguridad"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Health checks"})," en todos los servicios cr\xedticos"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Volumes"})," para persistencia de datos"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Networks"})," aisladas por stack"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Environment variables"})," nunca hardcodeadas"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Logs"})," centralizados y rotativos"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Backup"})," automatizado de vol\xfamenes"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"CI/CD"})," con tests antes de deploy"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Monitoring"})," con health endpoints"]}),"\n"]}),"\n",(0,o.jsx)(e.hr,{}),"\n",(0,o.jsx)(e.h2,{id:"-recursos",children:"\ud83d\udcda Recursos"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"https://docs.docker.com/develop/dev-best-practices/",children:"Docker Best Practices"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"https://docs.docker.com/compose/compose-file/",children:"Docker Compose Reference"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"https://docs.github.com/en/actions",children:"GitHub Actions Docs"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"https://nginx.org/en/docs/",children:"Nginx Documentation"})}),"\n"]})]})}function p(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(l,{...n})}):l(n)}},8453:(n,e,s)=>{s.d(e,{R:()=>i,x:()=>a});var t=s(6540);const o={},r=t.createContext(o);function i(n){const e=t.useContext(r);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:i(n.components),t.createElement(r.Provider,{value:e},n.children)}}}]);