"use strict";(globalThis.webpackChunkdocusaurus_juan_sebastian=globalThis.webpackChunkdocusaurus_juan_sebastian||[]).push([[6261],{4681:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"snippets/backend-snippets","title":"Backend \u2014 Patrones Modernos & Snippets Reutilizables","description":"Esta secci\xf3n re\xfane patrones pr\xe1cticos de desarrollo backend con Next.js, Node.js, TypeScript, MySQL, Firebase y arquitecturas RESTful escalables.","source":"@site/docs/snippets/backend-snippets.md","sourceDirName":"snippets","slug":"/snippets/backend-snippets","permalink":"/portafolio-juanSebastian/docs/snippets/backend-snippets","draft":false,"unlisted":false,"editUrl":"https://github.com/TheDuodecim/juan-sebastian-docs/tree/main/docs/snippets/backend-snippets.md","tags":[],"version":"current","frontMatter":{"id":"backend-snippets","title":"Backend \u2014 Patrones Modernos & Snippets Reutilizables"},"sidebar":"techSidebar","previous":{"title":"React 19.2 \u2014 Patrones Modernos & Snippets Reutilizables","permalink":"/portafolio-juanSebastian/docs/snippets/react-19-snippets"},"next":{"title":"Docker & DevOps \u2014 Patrones Modernos & Snippets Reutilizables","permalink":"/portafolio-juanSebastian/docs/snippets/docker-devops-snippets"}}');var t=r(4848),a=r(8453);const i={id:"backend-snippets",title:"Backend \u2014 Patrones Modernos & Snippets Reutilizables"},o="Backend \u2014 Patrones Modernos & Snippets Reutilizables",c={},d=[{value:"\ud83c\udfaf Next.js API Routes",id:"-nextjs-api-routes",level:2},{value:"API Route B\xe1sica con TypeScript",id:"api-route-b\xe1sica-con-typescript",level:3},{value:"API Route con Par\xe1metros Din\xe1micos",id:"api-route-con-par\xe1metros-din\xe1micos",level:3},{value:"Middleware de Autenticaci\xf3n",id:"middleware-de-autenticaci\xf3n",level:3},{value:"\ud83d\ude80 Node.js + Express + TypeScript",id:"-nodejs--express--typescript",level:2},{value:"Server Setup con TypeScript",id:"server-setup-con-typescript",level:3},{value:"RESTful Controller Pattern",id:"restful-controller-pattern",level:3},{value:"Service Layer Pattern",id:"service-layer-pattern",level:3},{value:"Middleware de Error Handling",id:"middleware-de-error-handling",level:3},{value:"\ud83d\uddc4\ufe0f MySQL con Node.js",id:"\ufe0f-mysql-con-nodejs",level:2},{value:"Conexi\xf3n con Pool",id:"conexi\xf3n-con-pool",level:3},{value:"Query Builder Helper",id:"query-builder-helper",level:3},{value:"Transactions",id:"transactions",level:3},{value:"\ud83d\udd25 Firebase Integration",id:"-firebase-integration",level:2},{value:"Firebase Admin Setup",id:"firebase-admin-setup",level:3},{value:"Firestore CRUD Operations",id:"firestore-crud-operations",level:3},{value:"Firebase Auth Middleware",id:"firebase-auth-middleware",level:3},{value:"Realtime Database Operations",id:"realtime-database-operations",level:3},{value:"\ud83d\udd10 Authentication Patterns",id:"-authentication-patterns",level:2},{value:"JWT Authentication",id:"jwt-authentication",level:3},{value:"Login/Register Controller",id:"loginregister-controller",level:3},{value:"\ud83c\udfaf Best Practices",id:"-best-practices",level:2},{value:"\ud83d\udcda Recursos",id:"-recursos",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"backend--patrones-modernos--snippets-reutilizables",children:"Backend \u2014 Patrones Modernos & Snippets Reutilizables"})}),"\n",(0,t.jsx)(n.p,{children:"Esta secci\xf3n re\xfane patrones pr\xe1cticos de desarrollo backend con Next.js, Node.js, TypeScript, MySQL, Firebase y arquitecturas RESTful escalables."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-nextjs-api-routes",children:"\ud83c\udfaf Next.js API Routes"}),"\n",(0,t.jsx)(n.h3,{id:"api-route-b\xe1sica-con-typescript",children:"API Route B\xe1sica con TypeScript"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// app/api/users/route.ts\nimport { NextRequest, NextResponse } from 'next/server';\n\nexport async function GET(request: NextRequest) {\n  try {\n    const searchParams = request.nextUrl.searchParams;\n    const page = searchParams.get('page') || '1';\n    \n    const users = await db.users.findMany({\n      skip: (parseInt(page) - 1) * 10,\n      take: 10,\n    });\n\n    return NextResponse.json({\n      success: true,\n      data: users,\n      page: parseInt(page),\n    });\n  } catch (error) {\n    return NextResponse.json(\n      { success: false, error: 'Failed to fetch users' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    \n    // Validaci\xf3n\n    if (!body.email || !body.name) {\n      return NextResponse.json(\n        { success: false, error: 'Missing required fields' },\n        { status: 400 }\n      );\n    }\n\n    const user = await db.users.create({\n      data: {\n        name: body.name,\n        email: body.email,\n      },\n    });\n\n    return NextResponse.json(\n      { success: true, data: user },\n      { status: 201 }\n    );\n  } catch (error) {\n    return NextResponse.json(\n      { success: false, error: 'Failed to create user' },\n      { status: 500 }\n    );\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"api-route-con-par\xe1metros-din\xe1micos",children:"API Route con Par\xe1metros Din\xe1micos"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// app/api/users/[id]/route.ts\nimport { NextRequest, NextResponse } from 'next/server';\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const user = await db.users.findUnique({\n      where: { id: params.id },\n    });\n\n    if (!user) {\n      return NextResponse.json(\n        { success: false, error: 'User not found' },\n        { status: 404 }\n      );\n    }\n\n    return NextResponse.json({ success: true, data: user });\n  } catch (error) {\n    return NextResponse.json(\n      { success: false, error: 'Server error' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const body = await request.json();\n\n    const user = await db.users.update({\n      where: { id: params.id },\n      data: body,\n    });\n\n    return NextResponse.json({ success: true, data: user });\n  } catch (error) {\n    return NextResponse.json(\n      { success: false, error: 'Failed to update user' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    await db.users.delete({\n      where: { id: params.id },\n    });\n\n    return NextResponse.json({ \n      success: true, \n      message: 'User deleted successfully' \n    });\n  } catch (error) {\n    return NextResponse.json(\n      { success: false, error: 'Failed to delete user' },\n      { status: 500 }\n    );\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"middleware-de-autenticaci\xf3n",children:"Middleware de Autenticaci\xf3n"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// app/api/protected/route.ts\nimport { NextRequest, NextResponse } from 'next/server';\nimport { verifyToken } from '@/lib/auth';\n\nexport async function GET(request: NextRequest) {\n  try {\n    const token = request.headers.get('authorization')?.split(' ')[1];\n\n    if (!token) {\n      return NextResponse.json(\n        { success: false, error: 'Unauthorized' },\n        { status: 401 }\n      );\n    }\n\n    const decoded = await verifyToken(token);\n\n    // L\xf3gica protegida\n    const data = await getProtectedData(decoded.userId);\n\n    return NextResponse.json({ success: true, data });\n  } catch (error) {\n    return NextResponse.json(\n      { success: false, error: 'Invalid token' },\n      { status: 401 }\n    );\n  }\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-nodejs--express--typescript",children:"\ud83d\ude80 Node.js + Express + TypeScript"}),"\n",(0,t.jsx)(n.h3,{id:"server-setup-con-typescript",children:"Server Setup con TypeScript"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// src/server.ts\nimport express, { Express, Request, Response, NextFunction } from 'express';\nimport cors from 'cors';\nimport helmet from 'helmet';\nimport compression from 'compression';\nimport morgan from 'morgan';\nimport { config } from './config';\nimport routes from './routes';\nimport { errorHandler } from './middleware/errorHandler';\n\nconst app: Express = express();\n\n// Middleware\napp.use(helmet());\napp.use(cors({\n  origin: config.corsOrigin,\n  credentials: true,\n}));\napp.use(compression());\napp.use(morgan('combined'));\napp.use(express.json({ limit: '10mb' }));\napp.use(express.urlencoded({ extended: true }));\n\n// Health check\napp.get('/health', (req: Request, res: Response) => {\n  res.status(200).json({ status: 'healthy', timestamp: Date.now() });\n});\n\n// Routes\napp.use('/api/v1', routes);\n\n// Error handling\napp.use(errorHandler);\n\n// Start server\nconst PORT = config.port || 3000;\napp.listen(PORT, () => {\n  console.log(`\ud83d\ude80 Server running on port ${PORT}`);\n});\n\nexport default app;\n"})}),"\n",(0,t.jsx)(n.h3,{id:"restful-controller-pattern",children:"RESTful Controller Pattern"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// src/controllers/userController.ts\nimport { Request, Response, NextFunction } from 'express';\nimport { UserService } from '../services/userService';\nimport { ApiError } from '../utils/ApiError';\n\nexport class UserController {\n  private userService: UserService;\n\n  constructor() {\n    this.userService = new UserService();\n  }\n\n  // GET /api/users\n  getAll = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const { page = 1, limit = 10, search } = req.query;\n\n      const result = await this.userService.findAll({\n        page: Number(page),\n        limit: Number(limit),\n        search: search as string,\n      });\n\n      res.status(200).json({\n        success: true,\n        data: result.users,\n        pagination: {\n          page: result.page,\n          limit: result.limit,\n          total: result.total,\n          pages: Math.ceil(result.total / result.limit),\n        },\n      });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  // GET /api/users/:id\n  getById = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const { id } = req.params;\n      const user = await this.userService.findById(id);\n\n      if (!user) {\n        throw new ApiError(404, 'User not found');\n      }\n\n      res.status(200).json({\n        success: true,\n        data: user,\n      });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  // POST /api/users\n  create = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const userData = req.body;\n      const user = await this.userService.create(userData);\n\n      res.status(201).json({\n        success: true,\n        data: user,\n      });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  // PUT /api/users/:id\n  update = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const { id } = req.params;\n      const userData = req.body;\n\n      const user = await this.userService.update(id, userData);\n\n      res.status(200).json({\n        success: true,\n        data: user,\n      });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  // DELETE /api/users/:id\n  delete = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const { id } = req.params;\n      await this.userService.delete(id);\n\n      res.status(200).json({\n        success: true,\n        message: 'User deleted successfully',\n      });\n    } catch (error) {\n      next(error);\n    }\n  };\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"service-layer-pattern",children:"Service Layer Pattern"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// src/services/userService.ts\nimport { db } from '../config/database';\nimport { ApiError } from '../utils/ApiError';\nimport bcrypt from 'bcrypt';\n\nexport interface CreateUserDto {\n  name: string;\n  email: string;\n  password: string;\n}\n\nexport interface UpdateUserDto {\n  name?: string;\n  email?: string;\n}\n\nexport class UserService {\n  async findAll(options: { page: number; limit: number; search?: string }) {\n    const { page, limit, search } = options;\n    const offset = (page - 1) * limit;\n\n    let query = 'SELECT * FROM users';\n    const params: any[] = [];\n\n    if (search) {\n      query += ' WHERE name LIKE ? OR email LIKE ?';\n      params.push(`%${search}%`, `%${search}%`);\n    }\n\n    query += ' LIMIT ? OFFSET ?';\n    params.push(limit, offset);\n\n    const [users] = await db.execute(query, params);\n\n    // Count total\n    const [countResult] = await db.execute(\n      'SELECT COUNT(*) as total FROM users'\n    );\n    const total = (countResult as any)[0].total;\n\n    return {\n      users,\n      page,\n      limit,\n      total,\n    };\n  }\n\n  async findById(id: string) {\n    const [rows] = await db.execute(\n      'SELECT * FROM users WHERE id = ?',\n      [id]\n    );\n    return (rows as any[])[0];\n  }\n\n  async findByEmail(email: string) {\n    const [rows] = await db.execute(\n      'SELECT * FROM users WHERE email = ?',\n      [email]\n    );\n    return (rows as any[])[0];\n  }\n\n  async create(data: CreateUserDto) {\n    // Check if email exists\n    const existing = await this.findByEmail(data.email);\n    if (existing) {\n      throw new ApiError(400, 'Email already exists');\n    }\n\n    // Hash password\n    const hashedPassword = await bcrypt.hash(data.password, 10);\n\n    const [result] = await db.execute(\n      'INSERT INTO users (name, email, password, created_at) VALUES (?, ?, ?, NOW())',\n      [data.name, data.email, hashedPassword]\n    );\n\n    const userId = (result as any).insertId;\n    return this.findById(userId);\n  }\n\n  async update(id: string, data: UpdateUserDto) {\n    const user = await this.findById(id);\n    if (!user) {\n      throw new ApiError(404, 'User not found');\n    }\n\n    const updates: string[] = [];\n    const params: any[] = [];\n\n    if (data.name) {\n      updates.push('name = ?');\n      params.push(data.name);\n    }\n\n    if (data.email) {\n      updates.push('email = ?');\n      params.push(data.email);\n    }\n\n    if (updates.length === 0) {\n      return user;\n    }\n\n    params.push(id);\n\n    await db.execute(\n      `UPDATE users SET ${updates.join(', ')}, updated_at = NOW() WHERE id = ?`,\n      params\n    );\n\n    return this.findById(id);\n  }\n\n  async delete(id: string) {\n    const user = await this.findById(id);\n    if (!user) {\n      throw new ApiError(404, 'User not found');\n    }\n\n    await db.execute('DELETE FROM users WHERE id = ?', [id]);\n    return true;\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"middleware-de-error-handling",children:"Middleware de Error Handling"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// src/middleware/errorHandler.ts\nimport { Request, Response, NextFunction } from 'express';\nimport { ApiError } from '../utils/ApiError';\n\nexport const errorHandler = (\n  err: Error,\n  req: Request,\n  res: Response,\n  next: NextFunction\n) => {\n  console.error('Error:', err);\n\n  if (err instanceof ApiError) {\n    return res.status(err.statusCode).json({\n      success: false,\n      error: err.message,\n    });\n  }\n\n  // Default error\n  res.status(500).json({\n    success: false,\n    error: 'Internal server error',\n  });\n};\n\n// src/utils/ApiError.ts\nexport class ApiError extends Error {\n  statusCode: number;\n\n  constructor(statusCode: number, message: string) {\n    super(message);\n    this.statusCode = statusCode;\n    this.name = 'ApiError';\n  }\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\ufe0f-mysql-con-nodejs",children:"\ud83d\uddc4\ufe0f MySQL con Node.js"}),"\n",(0,t.jsx)(n.h3,{id:"conexi\xf3n-con-pool",children:"Conexi\xf3n con Pool"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// src/config/database.ts\nimport mysql from 'mysql2/promise';\nimport { config } from './index';\n\nexport const db = mysql.createPool({\n  host: config.database.host,\n  user: config.database.user,\n  password: config.database.password,\n  database: config.database.name,\n  waitForConnections: true,\n  connectionLimit: 10,\n  queueLimit: 0,\n  enableKeepAlive: true,\n  keepAliveInitialDelay: 0,\n});\n\n// Test connection\nexport const testConnection = async () => {\n  try {\n    const connection = await db.getConnection();\n    console.log('\u2705 MySQL connected successfully');\n    connection.release();\n  } catch (error) {\n    console.error('\u274c MySQL connection failed:', error);\n    process.exit(1);\n  }\n};\n"})}),"\n",(0,t.jsx)(n.h3,{id:"query-builder-helper",children:"Query Builder Helper"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// src/utils/queryBuilder.ts\nexport class QueryBuilder {\n  private table: string;\n  private whereConditions: string[] = [];\n  private whereParams: any[] = [];\n  private selectFields: string = '*';\n  private limitValue?: number;\n  private offsetValue?: number;\n  private orderByClause?: string;\n\n  constructor(table: string) {\n    this.table = table;\n  }\n\n  select(fields: string | string[]) {\n    this.selectFields = Array.isArray(fields) ? fields.join(', ') : fields;\n    return this;\n  }\n\n  where(field: string, operator: string, value: any) {\n    this.whereConditions.push(`${field} ${operator} ?`);\n    this.whereParams.push(value);\n    return this;\n  }\n\n  whereIn(field: string, values: any[]) {\n    const placeholders = values.map(() => '?').join(', ');\n    this.whereConditions.push(`${field} IN (${placeholders})`);\n    this.whereParams.push(...values);\n    return this;\n  }\n\n  orderBy(field: string, direction: 'ASC' | 'DESC' = 'ASC') {\n    this.orderByClause = `ORDER BY ${field} ${direction}`;\n    return this;\n  }\n\n  limit(limit: number) {\n    this.limitValue = limit;\n    return this;\n  }\n\n  offset(offset: number) {\n    this.offsetValue = offset;\n    return this;\n  }\n\n  build(): { query: string; params: any[] } {\n    let query = `SELECT ${this.selectFields} FROM ${this.table}`;\n\n    if (this.whereConditions.length > 0) {\n      query += ` WHERE ${this.whereConditions.join(' AND ')}`;\n    }\n\n    if (this.orderByClause) {\n      query += ` ${this.orderByClause}`;\n    }\n\n    if (this.limitValue) {\n      query += ` LIMIT ${this.limitValue}`;\n    }\n\n    if (this.offsetValue) {\n      query += ` OFFSET ${this.offsetValue}`;\n    }\n\n    return {\n      query,\n      params: this.whereParams,\n    };\n  }\n}\n\n// Uso\nconst qb = new QueryBuilder('users')\n  .select(['id', 'name', 'email'])\n  .where('status', '=', 'active')\n  .where('age', '>', 18)\n  .orderBy('created_at', 'DESC')\n  .limit(10)\n  .offset(0);\n\nconst { query, params } = qb.build();\nconst [results] = await db.execute(query, params);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"transactions",children:"Transactions"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// src/services/orderService.ts\nimport { db } from '../config/database';\n\nexport class OrderService {\n  async createOrder(userId: string, items: any[]) {\n    const connection = await db.getConnection();\n    \n    try {\n      await connection.beginTransaction();\n\n      // 1. Create order\n      const [orderResult] = await connection.execute(\n        'INSERT INTO orders (user_id, total, status) VALUES (?, ?, ?)',\n        [userId, 0, 'pending']\n      );\n      const orderId = (orderResult as any).insertId;\n\n      // 2. Insert order items\n      let total = 0;\n      for (const item of items) {\n        await connection.execute(\n          'INSERT INTO order_items (order_id, product_id, quantity, price) VALUES (?, ?, ?, ?)',\n          [orderId, item.productId, item.quantity, item.price]\n        );\n        \n        // 3. Update stock\n        await connection.execute(\n          'UPDATE products SET stock = stock - ? WHERE id = ?',\n          [item.quantity, item.productId]\n        );\n\n        total += item.price * item.quantity;\n      }\n\n      // 4. Update order total\n      await connection.execute(\n        'UPDATE orders SET total = ? WHERE id = ?',\n        [total, orderId]\n      );\n\n      await connection.commit();\n\n      return { orderId, total };\n    } catch (error) {\n      await connection.rollback();\n      throw error;\n    } finally {\n      connection.release();\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-firebase-integration",children:"\ud83d\udd25 Firebase Integration"}),"\n",(0,t.jsx)(n.h3,{id:"firebase-admin-setup",children:"Firebase Admin Setup"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// src/config/firebase.ts\nimport * as admin from 'firebase-admin';\n\nconst serviceAccount = require('../../serviceAccountKey.json');\n\nadmin.initializeApp({\n  credential: admin.credential.cert(serviceAccount),\n  databaseURL: process.env.FIREBASE_DATABASE_URL,\n});\n\nexport const auth = admin.auth();\nexport const db = admin.firestore();\nexport const rtdb = admin.database();\nexport const storage = admin.storage();\n"})}),"\n",(0,t.jsx)(n.h3,{id:"firestore-crud-operations",children:"Firestore CRUD Operations"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// src/services/firestoreService.ts\nimport { db } from '../config/firebase';\nimport { ApiError } from '../utils/ApiError';\n\nexport class FirestoreService {\n  private collection: string;\n\n  constructor(collection: string) {\n    this.collection = collection;\n  }\n\n  async getAll() {\n    const snapshot = await db.collection(this.collection).get();\n    return snapshot.docs.map(doc => ({\n      id: doc.id,\n      ...doc.data(),\n    }));\n  }\n\n  async getById(id: string) {\n    const doc = await db.collection(this.collection).doc(id).get();\n    \n    if (!doc.exists) {\n      throw new ApiError(404, 'Document not found');\n    }\n\n    return {\n      id: doc.id,\n      ...doc.data(),\n    };\n  }\n\n  async create(data: any) {\n    const docRef = await db.collection(this.collection).add({\n      ...data,\n      createdAt: admin.firestore.FieldValue.serverTimestamp(),\n      updatedAt: admin.firestore.FieldValue.serverTimestamp(),\n    });\n\n    return this.getById(docRef.id);\n  }\n\n  async update(id: string, data: any) {\n    await db.collection(this.collection).doc(id).update({\n      ...data,\n      updatedAt: admin.firestore.FieldValue.serverTimestamp(),\n    });\n\n    return this.getById(id);\n  }\n\n  async delete(id: string) {\n    await db.collection(this.collection).doc(id).delete();\n    return true;\n  }\n\n  async query(filters: { field: string; operator: any; value: any }[]) {\n    let query: any = db.collection(this.collection);\n\n    filters.forEach(filter => {\n      query = query.where(filter.field, filter.operator, filter.value);\n    });\n\n    const snapshot = await query.get();\n    return snapshot.docs.map((doc: any) => ({\n      id: doc.id,\n      ...doc.data(),\n    }));\n  }\n\n  async paginate(limit: number, lastDoc?: any) {\n    let query = db.collection(this.collection).orderBy('createdAt').limit(limit);\n\n    if (lastDoc) {\n      query = query.startAfter(lastDoc);\n    }\n\n    const snapshot = await query.get();\n    \n    return {\n      data: snapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data(),\n      })),\n      lastDoc: snapshot.docs[snapshot.docs.length - 1],\n      hasMore: snapshot.docs.length === limit,\n    };\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"firebase-auth-middleware",children:"Firebase Auth Middleware"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// src/middleware/firebaseAuth.ts\nimport { Request, Response, NextFunction } from 'express';\nimport { auth } from '../config/firebase';\n\nexport interface AuthRequest extends Request {\n  user?: {\n    uid: string;\n    email: string;\n    [key: string]: any;\n  };\n}\n\nexport const verifyFirebaseToken = async (\n  req: AuthRequest,\n  res: Response,\n  next: NextFunction\n) => {\n  try {\n    const token = req.headers.authorization?.split('Bearer ')[1];\n\n    if (!token) {\n      return res.status(401).json({\n        success: false,\n        error: 'No token provided',\n      });\n    }\n\n    const decodedToken = await auth.verifyIdToken(token);\n    req.user = {\n      uid: decodedToken.uid,\n      email: decodedToken.email || '',\n      ...decodedToken,\n    };\n\n    next();\n  } catch (error) {\n    return res.status(401).json({\n      success: false,\n      error: 'Invalid token',\n    });\n  }\n};\n"})}),"\n",(0,t.jsx)(n.h3,{id:"realtime-database-operations",children:"Realtime Database Operations"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// src/services/realtimeDbService.ts\nimport { rtdb } from '../config/firebase';\n\nexport class RealtimeDbService {\n  async setValue(path: string, data: any) {\n    await rtdb.ref(path).set(data);\n  }\n\n  async updateValue(path: string, data: any) {\n    await rtdb.ref(path).update(data);\n  }\n\n  async getValue(path: string) {\n    const snapshot = await rtdb.ref(path).once('value');\n    return snapshot.val();\n  }\n\n  async pushValue(path: string, data: any) {\n    const ref = rtdb.ref(path).push();\n    await ref.set(data);\n    return ref.key;\n  }\n\n  async deleteValue(path: string) {\n    await rtdb.ref(path).remove();\n  }\n\n  // Listener en tiempo real\n  listenToChanges(path: string, callback: (data: any) => void) {\n    const ref = rtdb.ref(path);\n    \n    ref.on('value', (snapshot) => {\n      callback(snapshot.val());\n    });\n\n    // Retorna funci\xf3n para detener el listener\n    return () => ref.off('value');\n  }\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-authentication-patterns",children:"\ud83d\udd10 Authentication Patterns"}),"\n",(0,t.jsx)(n.h3,{id:"jwt-authentication",children:"JWT Authentication"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// src/utils/jwt.ts\nimport jwt from 'jsonwebtoken';\nimport { config } from '../config';\n\nexport interface TokenPayload {\n  userId: string;\n  email: string;\n}\n\nexport const generateToken = (payload: TokenPayload): string => {\n  return jwt.sign(payload, config.jwtSecret, {\n    expiresIn: config.jwtExpiresIn,\n  });\n};\n\nexport const verifyToken = (token: string): TokenPayload => {\n  return jwt.verify(token, config.jwtSecret) as TokenPayload;\n};\n\nexport const generateRefreshToken = (payload: TokenPayload): string => {\n  return jwt.sign(payload, config.jwtRefreshSecret, {\n    expiresIn: '7d',\n  });\n};\n"})}),"\n",(0,t.jsx)(n.h3,{id:"loginregister-controller",children:"Login/Register Controller"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// src/controllers/authController.ts\nimport { Request, Response, NextFunction } from 'express';\nimport bcrypt from 'bcrypt';\nimport { UserService } from '../services/userService';\nimport { generateToken, generateRefreshToken } from '../utils/jwt';\nimport { ApiError } from '../utils/ApiError';\n\nexport class AuthController {\n  private userService: UserService;\n\n  constructor() {\n    this.userService = new UserService();\n  }\n\n  register = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const { name, email, password } = req.body;\n\n      // Validaci\xf3n\n      if (!name || !email || !password) {\n        throw new ApiError(400, 'All fields are required');\n      }\n\n      if (password.length < 6) {\n        throw new ApiError(400, 'Password must be at least 6 characters');\n      }\n\n      const user = await this.userService.create({ name, email, password });\n\n      const token = generateToken({ userId: user.id, email: user.email });\n      const refreshToken = generateRefreshToken({ userId: user.id, email: user.email });\n\n      res.status(201).json({\n        success: true,\n        data: {\n          user: {\n            id: user.id,\n            name: user.name,\n            email: user.email,\n          },\n          token,\n          refreshToken,\n        },\n      });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  login = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const { email, password } = req.body;\n\n      if (!email || !password) {\n        throw new ApiError(400, 'Email and password are required');\n      }\n\n      const user = await this.userService.findByEmail(email);\n\n      if (!user) {\n        throw new ApiError(401, 'Invalid credentials');\n      }\n\n      const isValidPassword = await bcrypt.compare(password, user.password);\n\n      if (!isValidPassword) {\n        throw new ApiError(401, 'Invalid credentials');\n      }\n\n      const token = generateToken({ userId: user.id, email: user.email });\n      const refreshToken = generateRefreshToken({ userId: user.id, email: user.email });\n\n      res.status(200).json({\n        success: true,\n        data: {\n          user: {\n            id: user.id,\n            name: user.name,\n            email: user.email,\n          },\n          token,\n          refreshToken,\n        },\n      });\n    } catch (error) {\n      next(error);\n    }\n  };\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-best-practices",children:"\ud83c\udfaf Best Practices"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"TypeScript"})," para type safety en todo el backend"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Capas separadas"})," (Controller \u2192 Service \u2192 Repository)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Error handling"})," centralizado"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Validaci\xf3n"})," de datos en todos los endpoints"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Authentication"})," con JWT o Firebase"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Rate limiting"})," para prevenir abuse"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"CORS"})," configurado correctamente"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Environment variables"})," para configuraci\xf3n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Logging"})," estructurado (Winston, Pino)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Testing"})," unitario e integraci\xf3n"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-recursos",children:"\ud83d\udcda Recursos"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://nextjs.org/docs/app/building-your-application/routing/route-handlers",children:"Next.js API Routes"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://expressjs.com/en/advanced/best-practice-performance.html",children:"Express Best Practices"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/8.0/en/optimization.html",children:"MySQL Best Practices"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://firebase.google.com/docs/admin/setup",children:"Firebase Admin SDK"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>o});var s=r(6540);const t={},a=s.createContext(t);function i(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);